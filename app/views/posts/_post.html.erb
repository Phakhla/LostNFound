<% content_for :meta do %>
  <meta property="og:url" content="<%= request.original_url %>" />
  <meta property="og:type" content="article" />
  <meta property="og:title" content="<%= post.name %>" />
  <meta property="og:description" content="<%= post.detail || "more detail" %>" />
  <% if post.images.attached? %>
    <meta property="og:image" content="<%= polymorphic_url(post.images.first) %>" />
  <% else %>
    <meta property="og:image" content="https://c.ndtvimg.com/2020-08/h5mk7js_cat-generic_625x300_28_August_20.jpg?im=Resize=(1230,900)" />
  <% end %>
<% end %>

<div id="<%= dom_id @post %>">
  <div class="row">
    <div class="col-sm-12 text-start" style="font-size: 20px;">
      <%= link_to(root_path, style: 'text-decoration: none;') do %>
          <i class="fa-solid fa-arrow-left"></i>
          ย้อนกลับ
      <% end %>
    </div>
    <div class="col-sm-4">
    </div>
    <div class="col-sm-8 text-end ">
      <% if user_signed_in? && post.owner?(current_user) && post.active? %>
        <button type="button" class="btn bg-color--primary100" data-bs-toggle="modal" data-bs-target="#myModal"><i class="fa-solid fa-trash-can"></i>  ลบโพสต์</button>
        <button type="button" class="btn btn--outline-primary-width" data-bs-toggle="modal" data-bs-target="#closeRemovePostModal">ปิดโพสต์นี้</button>
        <%= link_to 'แก้ไข', edit_post_path(post) , class: 'btn btn--primary-black' %>
      <% end %>
    </div>
  </div>
  <div class="row g-0 mt-4">
    <div class="card p-5 border-dark" style="border-radius: 15px">
      <div class="card-body">
        <div class="row m-2">
          <div class="col-9">
            <h3 class="card-title"><%= post.name %></h3>
          </div>
          <div class="col text-end">
            <% if post.active? %>
              <p class="card-text p-2 text-center" style="margin-left: auto; margin-right: 0; width: 50%; color: white; border-radius: 20px; background-color: #8BB72FFF;">
                <span class="dot" style="position: relative; height: 10px; width: 10px; background-color: #ffffff; border-radius: 100%; display: inline-block;"></span>
                กำลังตามหา
              </p>
            <% else %>
              <p class="card-text p-2 text-center" style="margin-left: auto; margin-right: 0; width: 60%; color: white; border-radius: 20px; background-color: #f03d3d;">
                ปิดโพสต์ตามหา
              </p>
            <% end %>
            <p class="card-text">
              <span class="fw-bold">วันที่โพสต์ : </span>
              <%= post.created_at.strftime("%d %B %y") %>
            </p>
          </div>
        </div>
        <hr style="height: 2px; background-color:black;">
        <div class="row mt-5">
          <div class="col-7">
            <div class="row mt-2">
            <!--Carousel-->
              <div id="carouselExampleDark" class="carousel carousel-dark slide" data-bs-ride="carousel">
                <% if post.images.attached? %>
                  <div class="carousel-indicators" style="buttom: 100px;">
                    <% post.images.each_with_index do |image, index| %>
                      <button type="button" style="width: 200px; background: rgba(0, 0, 0, 0);" data-bs-target="#carouselExampleDark" data-bs-slide-to="<%= index %>" class="<%= "active " if index==0 %>" aria-current="true" aria-label="Slide <%= index %>">
                          <%= image_tag(image, style: "display: block; width: 100%; height: 80px; border-radius: 15px;") %>
                      </button>
                    <% end %>
                  </div>
                <% end %>
                <% if post.images.attached? %>
                  <div class="carousel-inner">
                      <% post.images.each_with_index do |image, i| %>
                        <div class="carousel-item <%= "active " if i==0 %>">
                          <%= image_tag(image, style: "width:100%; height: 500px; display: flex; border-radius: 15px;") %>
                        </div>
                      <% end %>
                  </div>
                <% end %>
                <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleDark" data-bs-slide="prev">
                  <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                  <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleDark" data-bs-slide="next">
                  <span class="carousel-control-next-icon" aria-hidden="true"></span>
                  <span class="visually-hidden">Next</span>
                </button>
              </div>
            </div>
          </div>
          <div class="col ps-5">
            <% if post.lost_item? %>
              <p class="card-text text-center" style="width: 35%; color: #312FA9; border-radius: 10px; background-color: #B2C5FC;">
                โพสต์หาของหาย
              </p>
            <% else %>
              <p class="card-text text-center" style="width: 35%; color: #C86111; border-radius: 10px; background-color: #F7E3B0;">
                โพสต์หาเจ้าของ
              </p>
            <% end %>
            <p class="card-text fw-bold" style="font-size: 20px;"><%= post.location %></p>
            <p class="card-text"><%= post.detail %></p>
            <p class="card-text fw-bold pt-5" style="font-size: 20px;">รายละเอียด</p>
            <p class="card-text">ประเภท&emsp;<%= Type.find(post.type_id).type_name %></p>
            <hr>
            <p class="card-text">วันที่พบ&emsp;<%= post.date.strftime("%d %B %y") %></p>
            <hr>
            <p class="card-text">สถานที่&emsp;<%= post.location %></p>
            <hr>

            <!-- Location -->
            <%= simple_form_for post, { data: { controller: 'show-map'} } do |f| %>
              <%= f.hidden_field :lat, data: { show_map_target: "latitude" } %>
              <%= f.hidden_field :lng, data: { show_map_target: "longitude"} %>
              <%= f.hidden_field :location, data: { show_map_target: "address"} %>
              <%= content_tag :div, nil, data: { action: 'google-maps-callback@window->show-map#showMap', show_map_target: "map" }, class: 'map mb-5 mt-5' %>
            <% end %>

            <div class="create-poster">
              <% if user_signed_in? && post.owner?(current_user) && post.active? %>
                <%= link_to(new_post_poster_path(post), class: 'btn btn--secondary p-3', style: 'width: 100%;' ) do %>
                  <i class="fa-solid fa-wand-magic-sparkles"></i> สร้างโปสเตอร์
                <% end %>
              <% end %>
            </div>
          </div>
        </div>
        <br><br><br><br><br><br>
        <hr style="height: 2px; background-color:black;">
        <div class="row mt-5">
          <div class="col-9 d-flex align-items-center">
            <div class="user-avatar pe-5">
              <% if post.user.avatar.present? %>
                <%= image_tag(post.user.avatar, style:"width: 50px; height: 50px; object-fit: cover;", class: "rounded-circle") %>
              <% else %>
                <img alt="image" class="rounded-circle" src="https://media.istockphoto.com/vectors/default-profile-picture-avatar-photo-placeholder-vector-illustration-vector-id1223671392?k=20&m=1223671392&s=612x612&w=0&h=lGpj2vWAI3WUT1JeJWm1PRoHT3V15_1pdcTn2szdwQ0=" style = "width: 40px; height: 40px; object-fit: cover;">
              <% end %>
            </div>
            <div class="user-info">
              <p class="card-text fw-bold">
                <%= post.user.username %>
              </p>
              <p class="card-text">ติดต่อ :
                <i class="fa-solid fa-phone" style="font-size: 20px;"></i> <%= phone_to post.user.tel, style: 'text-decoration: none;' %>
                <%= link_to(post.user.fblink, style: 'text-decoration: none;') do %>
                    <i class="fa-brands fa-facebook-square" style="font-size: 25px;"></i>
                    <%= post.user.facebook %>
                <% end %>
              </p>
              <% if !post.user.not_show_address %>
                <p class="card-text">ที่อยู่ : <%= post.user.address %></p>
              <% end %>
            </div>
          </div>
          <div class="col d-flex justify-content-end">
            <p class="card-text d-flex align-items-center">แชร์โพสต์นี้ :
              <%= link_to("https://www.facebook.com/sharer/sharer.php?u=" + request.original_url, :target => :popup, style: 'padding: 10px; text-decoration: none;')  do %>
                <i class="fa-brands fa-facebook-square" style="font-size: 30px; color: #4267B2;"></i>
              <% end %>
              <%= button_tag 'Copy link', class: 'btn btn--primary', style: '', data: { controller: 'clipboard', action: 'clipboard#copyToClipboard' } %>
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal delete post -->
<div class="modal fade" id="myModal" tabindex="-1" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" id="myModalLabel"></h4>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body justify-content-center" style="text-align: center; padding: 110px 0;">
        คุณต้องการลบโพสนี้ใช่ไหม ?
      </div>
      <div class="modal-footer justify-content-center">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ยกเลิก</button>
        <%= button_to "ยืนยัน", post, method: :delete , class: 'btn'%>
      </div>
    </div>
  </div>
</div>
<!-- Modal close post -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered ">
      <%= simple_form_for @post, url: post_path, method: 'patch', data: { controller: "radio-selection", action: "radio-selection#checkOption" } do |f| %>
        <div class="close-post-modal">
          <div class="modal-content">
            <div class="close-btn">
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-header">
              <p class="modal-title" id="exampleModalLabel">คุณต้องการปิดโพสนี้ใช่ไหม?</p>
            </div>
            <div class="modal-body justify-content-center">
              <div class="modal-text">
                <p class="mb">กรุณาเลือกเหตุผล</p>
                <p>
                  <label class="cursor-pointer">
                    <%= radio_button 'status', '', 'พบเจอของ/เจ้าของแล้ว', data: { radio_selection_target: "foundRadioButton" } %> พบเจอของ/เจ้าของแล้ว
                  </label>
                </p>
                <p>
                  <label class="cursor-pointer">
                    <%= radio_button 'status', '', 'ไม่ต้องการค้นหาอีกต่อไป', data: { radio_selection_target: "hopelessRadioButton" } %> ไม่ต้องการค้นหาอีกต่อไป
                  </label>
                </p>
                <p>
                  <label class="cursor-pointer">
                    <%= radio_button 'status', '', nil, data: { radio_selection_target: "otherRadioButton" } %> อื่นๆ โปรดระบุ
                    <%= text_field_tag :other_reason, '', data: { radio_selection_target: "textInput" }, class:'form-control' %>
                  </label>
                </p>
                <p>
                  <%= f.hidden_field :status, data: { radio_selection_target: "statusInput" } %>
                  <%= f.hidden_field :reason, data: { radio_selection_target: "reasonInput" } %>
                </p>
              </div>
            </div>
            <div class="modal-footer justify-content-center">
              <%= f.button :button, "ยกเลิก", type: "button", class: "btn btn--outline-primary style", data: { bs_dismiss: 'modal' } %>
              <%= f.button :button, "ยืนยัน", class: "btn btn--primary" %>
            </div>
          </div>
        </div>
      <% end %>
	</div>
</div>
